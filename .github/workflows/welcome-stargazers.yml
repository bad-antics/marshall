name: Welcome Stargazers & Forkers

on:
  watch:
    types: [started]
  fork:
  workflow_dispatch:

permissions:
  issues: write

jobs:
  welcome-stargazer:
    if: github.event_name == 'watch'
    runs-on: ubuntu-latest
    steps:
      - name: Thank Stargazer
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const stargazer = context.actor;
            const owner = context.repo.owner;

            if (stargazer === owner) return;

            console.log(`‚≠ê ${stargazer} starred ${context.repo.repo}!`);

            try {
              const { data: user } = await github.rest.users.getByUsername({
                username: stargazer
              });

              console.log(`üìä ${stargazer} has ${user.public_repos} repos, ${user.followers} followers`);

              if (user.public_repos > 5 && user.followers > 5) {
                console.log(`ü§ù ${stargazer} looks like an engaged developer!`);

                const { data: repos } = await github.rest.repos.listForUser({
                  username: stargazer,
                  sort: 'stars',
                  per_page: 5
                });

                for (const repo of repos) {
                  if (!repo.fork && repo.stargazers_count > 0) {
                    console.log(`üîç Top repo: ${stargazer}/${repo.name} (${repo.stargazers_count} ‚≠ê)`);
                    break;
                  }
                }
              }
            } catch (e) {
              console.log(`‚ö†Ô∏è Could not look up user ${stargazer}: ${e.message}`);
            }

  welcome-forker:
    if: github.event_name == 'fork'
    runs-on: ubuntu-latest
    steps:
      - name: Thank Forker
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const forker = context.payload.forkee.owner.login;
            const owner = context.repo.owner;

            if (forker === owner) return;

            console.log(`üç¥ ${forker} forked ${context.repo.repo}!`);
            console.log(`üìã Fork: ${context.payload.forkee.full_name}`);
